import{j as y}from"./jsx-runtime-D_zvdyIk.js";import{e as x}from"./index-DI7CEG0L.js";import{D as F,i as c,z as p,G as j}from"./styles-BFdRcqeG.js";import{V}from"./index-BzmpT3sc.js";function k(h,t,e){const s=e,i=[];for(let o=0;o<h.length;o++)i.push((t-h[o])*s);return i}function z(h,t){return{inputRange:k([1,0,-1],h,t),outputRange:[0,1,0]}}function N(h,t){let e={},s={};const{inactiveSlideOpacity:i=1,inactiveSlideScale:o=1}=t;return i<1&&(e={opacity:h.interpolate({inputRange:[0,1],outputRange:[i,1]})}),o<1&&(s={transform:[{scaleY:h.interpolate({inputRange:[0,1],outputRange:[o,1]})}]}),{...e,...s}}const I=j.OS==="android",S=F.get("window").width,T=class T extends x.PureComponent{constructor(t){super(t),this.state={hideCarousel:!!t.apparitionDelay,interpolators:[],containerWidth:S,itemWidth:S-c.L*2};const e=this._getFirstItem(t.firstItem||0);this._activeItem=e,this._onScrollActiveItem=e,this._previousFirstItem=e,this._previousItemsLength=e,this._mounted=!1,this._positions=[],this._currentScrollOffset=0,this._scrollEnabled=t.scrollEnabled,this._getItemLayout=this._getItemLayout.bind(this),this._getKeyExtractor=this._getKeyExtractor.bind(this),this._onLayout=this._onLayout.bind(this),this._onScroll=this._onScroll.bind(this),this._onMomentumScrollEnd=this._onMomentumScrollEnd.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._renderItem=this._renderItem.bind(this),this._setScrollHandler(t)}componentDidMount(){const{apparitionDelay:t,autoplay:e}=this.props;this._mounted=!0,this._initPositionsAndInterpolators(),this._initTimeout=setTimeout(()=>{if(!this._mounted)return;const s=()=>{t&&this.setState({hideCarousel:!1}),e&&this.startAutoplay()};t?this._apparitionTimeout=setTimeout(()=>{s()},t):s()},1)}componentDidUpdate(t){const{interpolators:e}=this.state,{firstItem:s=0,scrollEnabled:i}=this.props,o=this._getCustomDataLength(this.props);if(!o)return;const n=this._getFirstItem(s,this.props);let a=typeof this._activeItem<"u"?this._activeItem:n;a>o-1&&(a=o-1),i!==t.scrollEnabled&&this._setScrollEnabled(i),e.length!==o?(this._activeItem=a,this._previousItemsLength=o,this._initPositionsAndInterpolators(this.props)):n!==this._previousFirstItem&&n!==this._activeItem&&(this._activeItem=n,this._previousFirstItem=n,this._snapToItem(n,!1,!0,!0)),this.props.onScroll!==t.onScroll&&this._setScrollHandler(this.props)}componentWillUnmount(){this._mounted=!1,this.stopAutoplay(),clearTimeout(this._initTimeout),clearTimeout(this._apparitionTimeout),clearTimeout(this._enableAutoplayTimeout),clearTimeout(this._autoplayTimeout),clearTimeout(this._snapNoMomentumTimeout),clearTimeout(this._androidRepositioningTimeout)}_setScrollHandler(t){const e={listener:this._onScroll,useNativeDriver:!0};this._scrollPos=new p.Value(0);const s=[{nativeEvent:{contentOffset:{x:this._scrollPos}}}];if(t.onScroll&&Array.isArray(t.onScroll._argMapping)){s.pop();const[i]=t.onScroll._argMapping;i&&i.nativeEvent&&i.nativeEvent.contentOffset&&(this._scrollPos=i.nativeEvent.contentOffset.x||i.nativeEvent.contentOffset.y||this._scrollPos),s.push(...t.onScroll._argMapping)}this._onScrollHandler=p.event(s,e)}_enableLoop(){const{data:t,enableSnap:e,loop:s}=this.props;return e&&s&&t&&t.length&&t.length>1}_shouldAnimateSlides(t=this.props){const{inactiveSlideOpacity:e=1,inactiveSlideScale:s=1}=t;return e<1||s<1}_shouldRepositionScroll(t){const{data:e,enableSnap:s,loopClonesPerSide:i=3}=this.props,o=e&&e.length;return!(!s||!o||!this._enableLoop()||t>=i&&t<o+i)}_isMultiple(t,e){return Math.round(Math.round(t/e)/(1/e))===Math.round(t)}_getCustomData(t=this.props){const{data:e,loopClonesPerSide:s=3}=t,i=e&&e.length;if(!i)return[];if(!this._enableLoop())return e;let o=[],n=[];if(s>i){const a=Math.floor(s/i),r=s%i;for(let l=0;l<a;l++)o.push(...e),n.push(...e);o.unshift(...e.slice(-r)),n.push(...e.slice(0,r))}else o=e.slice(-s),n=e.slice(0,s);return o.concat(e,n)}_getCustomDataLength(t=this.props){const{data:e,loopClonesPerSide:s=3}=t,i=e&&e.length;return i?this._enableLoop()?i+2*s:i:0}_getCustomIndex(t,e=this.props){return!this._getCustomDataLength(e)||typeof t>"u"?0:t}_getDataIndex(t){const{data:e,loopClonesPerSide:s=3}=this.props,i=e&&e.length;if(!this._enableLoop()||!i)return t;if(t>=i+s)return s>i?(t-s)%i:t-i-s;if(t<s)if(s>i){const o=[],n=[],a=Math.floor(s/i),r=s%i;for(let l=0;l<i;l++)o.push(l);for(let l=0;l<a;l++)n.push(...o);return n.unshift(...o.slice(-r)),n[t]}else return t+i-s;else return t-s}_getFirstItem(t,e=this.props){const{loopClonesPerSide:s=3}=e,i=this._getCustomDataLength(e);return!i||t>i-1||t<0?0:this._enableLoop()?t+s:t}_getWrappedRef(){return this._carouselRef}_getScrollEnabled(){return this._scrollEnabled}_setScrollEnabled(t=!0){this._scrollEnabled=t}_getItemMainDimension(){const{itemWidth:t}=this.state,{full:e}=this.props;return e?t:t+c.S}_getItemScrollOffset(t){return this._positions&&this._positions[t]&&this._positions[t].start}_getItemLayout(t,e){const s=this._getItemMainDimension();return{index:e,length:s,offset:s*e}}_getKeyExtractor(t,e){return`flatlist-item-${e}`}_getScrollOffset(t){return t.nativeEvent.contentOffset.x}_getActiveSlideOffset(){const{activeSlideOffset:t=0}=this.props,e=this._getItemMainDimension(),s=10;return e/2-t>=s?t:s}_getActiveItem(t){const e=this._getItemMainDimension(),s=t+e/2,i=this._getActiveSlideOffset(),o=this._positions.length-1;let n;if(t<=0)return 0;if(this._positions[o]&&t>=this._positions[o].start)return o;for(let a=0;a<this._positions.length;a++){const{start:r,end:l}=this._positions[a];if(s+i>=r&&s-i<=l){n=a;break}}return n||0}_initPositionsAndInterpolators(t=this.props){const{data:e}=t,s=this._getItemMainDimension();if(!e||!e.length)return;const i=[];this._positions=[],this._getCustomData(t).forEach((o,n)=>{const a=this._getCustomIndex(n,t);let r;if(this._positions[n]={start:n*s,end:n*s+s},!this._shouldAnimateSlides(t)||!this._scrollPos)r=new p.Value(1);else{let l=z(a,this.state.itemWidth);r=this._scrollPos.interpolate({...l,extrapolate:"clamp"})}i.push(r)}),this.setState({interpolators:i})}_repositionScroll(t,e=!1){const{data:s,loopClonesPerSide:i=3}=this.props,o=s&&s.length;if(typeof t>"u"||!this._shouldRepositionScroll(t))return;let n=t;t>=o+i?n=t-o:t<i&&(n=t+o),this._snapToItem(n,e,!1)}_onTouchStart(t){const{onTouchStart:e}=this.props;this._getScrollEnabled()!==!1&&this._autoplaying&&this.pauseAutoPlay(),e&&e(t)}_onTouchEnd(t){const{onTouchEnd:e}=this.props;this._getScrollEnabled()!==!1&&this._autoplay&&!this._autoplaying&&this.startAutoplay(),e&&e(t)}_onScroll(t){const{onScroll:e,onScrollIndexChanged:s,onSnapToItem:i}=this.props,o=t?this._getScrollOffset(t):this._currentScrollOffset,n=this._getActiveItem(o),a=this._getCustomDataLength();this._getItemScrollOffset(a-1),this._currentScrollOffset=o,n!==this._onScrollActiveItem&&(this._onScrollActiveItem=n,s&&s(this._getDataIndex(n)),i&&i(this._getDataIndex(n))),typeof e=="function"&&t&&e(t)}_onMomentumScrollEnd(t){const{autoplayDelay:e,onMomentumScrollEnd:s,onSnapToItem:i}=this.props,{itemWidth:o}=this.state,n=t?this._getScrollOffset(t):this._currentScrollOffset,a=this._getActiveItem(n);this._isMultiple(n,o),a!==this._activeItem&&(this._activeItem=a,i&&i(this._getDataIndex(a))),s&&s(t)}_onLayout(t){const{onLayout:e,visibleItem:s=1}=this.props;this._onLayoutInitDone?(this._initPositionsAndInterpolators(),this._snapToItem(this._activeItem,!1,!1,!0)):this._onLayoutInitDone=!0;const i=t.nativeEvent.layout.width;let o=this.props.visibleItem===1?S-c.M*2:Math.ceil((i*.9-s*c.S)/s);this.props.itemWidth&&(o=this.props.itemWidth),this.props.full&&(o=i),this.setState({containerWidth:i,itemWidth:o}),e&&e(t)}_getPositionIndex(t){const{loop:e,loopClonesPerSide:s=3}=this.props;return e?t+s:t}_snapToItem(t,e=!0,s=!0,i=!1){const{onSnapToItem:o}=this.props,n=this._getCustomDataLength(),a=this._getWrappedRef();if(!n||!a||(!t||t<0?t=0:n>0&&t>=n&&(t=n-1),t===this._activeItem&&!i))return;this._carouselRef.scrollToIndex({index:t,animated:!0}),(!e||I)&&(this._activeItem=t,s&&o&&o(this._getDataIndex(t)))}_renderItem(t){const{item:e,index:s}=t,{interpolators:i,itemWidth:o}=this.state,{slideStyle:n,full:a}=this.props,r=i&&i[s];if(typeof r>"u")return null;const m=this._shouldAnimateSlides()?p.View:V,_={width:o};let u=this.props.loop?{marginLeft:c.S}:{marginLeft:s===0?c.M:0,marginRight:s===this._getCustomDataLength()-1?c.M:c.S};a&&(u={});const d=N(r,this.props);return y.jsx(m,{style:[_,d,{overflow:"hidden"},u,n],pointerEvents:"box-none",children:this.props.renderItem({item:e,index:s})})}startAutoplay(){const{autoplayInterval:t,autoplayDelay:e}=this.props;this._autoplay=!0,!this._autoplaying&&(clearTimeout(this._autoplayTimeout),this._autoplayTimeout=setTimeout(()=>{this._autoplaying=!0,this._autoplayInterval=setInterval(()=>{this._autoplaying&&this.snapToNext()},t)},e))}pauseAutoPlay(){this._autoplaying=!1,clearTimeout(this._autoplayTimeout),clearTimeout(this._enableAutoplayTimeout),clearInterval(this._autoplayInterval)}stopAutoplay(){this._autoplay=!1,this.pauseAutoPlay()}snapToItem(t,e=!0,s=!0){(!t||t<0)&&(t=0);const i=this._getPositionIndex(t);i!==this._activeItem&&this._snapToItem(i,e,s)}snapToNext(t=!0,e=!0){const s=this._getCustomDataLength();let i=this._activeItem+1;i>s-1&&(i=0),this._snapToItem(i,t,e)}snapToPrev(t=!0,e=!0){const s=this._getCustomDataLength();let i=this._activeItem-1;i<0&&(i=s-1),this._snapToItem(i,t,e)}render(){const{loopClonesPerSide:t=3,visibleItem:e=1,firstItem:s=0,getItemLayout:i,keyExtractor:o,style:n,disableIntervalMomentum:a,enableSnap:r,contentContainerStyle:l}=this.props,{hideCarousel:m}=this.state,_=this._enableLoop()?t:2,u=e>2?e+_*2:_*2,d=u,O=d,R=r?this._getItemMainDimension():void 0,w={getItemLayout:i||this._getItemLayout,initialScrollIndex:this._getFirstItem(s),keyExtractor:o||this._getKeyExtractor,renderItem:this._renderItem};return y.jsx(p.FlatList,{...this.props,...w,ref:W=>this._carouselRef=W,overScrollMode:"never",snapToInterval:this.props.snapToInterval?this.props.snapToInterval:R,disableIntervalMomentum:a,pointerEvents:m?"none":"auto",decelerationRate:"fast",numColumns:1,style:[n,{width:"100%",flexDirection:"row"},m?{opacity:0}:{}],automaticallyAdjustContentInsets:!1,directionalLockEnabled:!0,contentContainerStyle:l,disableScrollViewPanResponder:!1,pinchGestureEnabled:!1,scrollsToTop:!1,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,initialNumToRender:u,maxToRenderPerBatch:d,windowSize:O,pagingEnabled:r,data:this._getCustomData(),horizontal:!0,scrollEventThrottle:1,onLayout:this._onLayout,onMomentumScrollEnd:this._onMomentumScrollEnd,onScroll:this._onScrollHandler,onTouchStart:this._onTouchStart,onTouchEnd:this._onTouchEnd})}};T.defaultProps={activeSlideAlignment:"start",activeSlideOffset:20,apparitionDelay:0,autoplay:!1,autoplayDelay:1e3,autoplayInterval:3e3,callbackOffsetMargin:5,containerCustomStyle:{},contentContainerCustomStyle:{},enableSnap:!0,firstItem:0,hasParallaxImages:!1,loop:!1,loopClonesPerSide:3,scrollEnabled:!0,slideStyle:{},shouldOptimizeUpdates:!0,vertical:!1,isCustomScrollWidth:!1,disableIntervalMomentum:I,useExperimentalSnap:I,visibleItem:1,full:!1};let v=T;const G={title:"Library/Carousel",component:v,parameters:{layout:"centered"},tags:["autodocs"]},A=[{id:"1",title:"Item 1",color:"#FF5733"},{id:"2",title:"Item 2",color:"#33FF57"},{id:"3",title:"Item 3",color:"#3357FF"}],P=({item:h})=>y.jsx("div",{style:{width:"200px",height:"200px",backgroundColor:h.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"24px"},children:h.title}),f={args:{data:A,renderItem:P,itemWidth:200,loop:!0,enableSnap:!0}},g={args:{data:A,renderItem:P,itemWidth:200,loop:!0,enableSnap:!0,autoplay:!0,autoplayInterval:3e3,autoplayDelay:1e3}};var b,D,L;f.parameters={...f.parameters,docs:{...(b=f.parameters)==null?void 0:b.docs,source:{originalSource:`{
  args: {
    data: sampleData,
    renderItem,
    itemWidth: 200,
    loop: true,
    enableSnap: true
  }
}`,...(L=(D=f.parameters)==null?void 0:D.docs)==null?void 0:L.source}}};var E,M,C;g.parameters={...g.parameters,docs:{...(E=g.parameters)==null?void 0:E.docs,source:{originalSource:`{
  args: {
    data: sampleData,
    renderItem,
    itemWidth: 200,
    loop: true,
    enableSnap: true,
    autoplay: true,
    autoplayInterval: 3000,
    autoplayDelay: 1000
  }
}`,...(C=(M=g.parameters)==null?void 0:M.docs)==null?void 0:C.source}}};const B=["Default","WithAutoplay"];export{f as Default,g as WithAutoplay,B as __namedExportsOrder,G as default};
